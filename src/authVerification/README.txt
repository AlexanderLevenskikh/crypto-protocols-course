Прямой способ проверки ключевой информации

Пусть у клиента (Alice) и сервера (Bob) есть общий секрет, недоступный третьей стороне.
Alice и Bob создают ключи и обмениваются ими по сети
Далее, каждый шифрует сгенерированный случайный текст полученным ключом и отправляет шифртекст по частям
1 часть посылает Alice
1 часть посылает Bob
2 часть посылает Alice
2 часть посылает Bob
Полученный шифртекст склеивают и расшифровывают собственными ключами, зашифровывают при помощи секрета MAC
обмениваются шифртекстами, при получении осуществляют расшифрование и проверяют, равен ли полученный текст сгенерированному.

Если совпадают - все хорошо, иначе - Man in the middle (Ева)

Вывод программы:

Alice создает ключ aliceKey, передает его Bob'y
Bob создает ключ bobKey, передает его Alice
Alice шифрует текст "national" ключом, полученным от Bob
Шифртекст: 3d972185ad95c14631b82b15f9fc98e3
Bob шифрует текст "spoken" ключом, полученным от Alice
Шифртекст: a5f975d1e366335a
Alice и Bob обмениваются половинками шифртекстов
Alice передает первую часть Bob: 3d972185ad95c146
Bob передает первую часть Alice: a5f975d1
Alice передает вторую часть Bob: 31b82b15f9fc98e3
Bob передает вторую часть Alice: e366335a
Alice и Bob осуществляют расшифрование полученных сообщений
Alice расшифровала сообщение: spoken
Bob расшифровал сообщение: national
Alice и Bob шифруют полученные тексты при помощи MAC и отправляют друг другу
Alice получила шифртекст 323123fa8b76068590d5c9f419c73121 и Bob 5abe8e9da5b72d60
Alice подтверждает подлинность Bob
Bob подтверждает подлинность Alice
